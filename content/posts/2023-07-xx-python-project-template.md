---
draft: true
date: 2023-07-25
authors:
  - daxartio
categories:
  - python
tags:
  - python
  - template
  - cookiecutter
---

# Python Project Template

В этой статье я расскажу какие преимущества использования шаблона проекта для Python и как его создать с помощью cookiecutter. Также я расскажу про структуру проекта и какие инструменты я использую в своем шаблоне и почему.

<!-- more -->

## Почему нужен шаблон проекта

Создание шаблона проекта позволяет сэкономить время на настройку проекта, а также сделать его структуру более удобной для разработки.

## Cookiecutter

Пару слов про cookiecutter. Это инструмент, который позволяет создавать проекты из шаблонов. Шаблон представляет собой git репозиторий, в котором есть файл cookiecutter.json, в котором описаны переменные, которые нужно будет заполнить при создании проекта. После заполнения переменных cookiecutter клонирует репозиторий и заменяет переменные на значения, которые вы ввели. Также cookiecutter может запустить скрипты, которые могут сделать какие-то дополнительные действия. Например, cookiecutter может создать git репозиторий, установить зависимости, запустить тесты и т.д.

## Пример готового шаблона

Дальше я расскажу про свой шаблон проекта и какие нюансы мне пришлось решать.

Я в какой-то момент захотел сделать свой шаблон проекта для Python. Вы можете найти его [здесь](https://github.com/daxartio/python-project-template).

Причина почему я сделал свой шаблон проекта, а не использовал готовый, заключается в том, что я хотел сделать его максимально простым и удобным для себя.

Что я хотел видеть в шаблоне проекта:

- Проверка кода: mypy, black
- Запуск тестов: pytest
- Публикация пакета в PyPI
- Публикация документации в Github Pages

### Автоматические релизы

Со временем я эксперементировал с разными инструментами и добавлял их в шаблон проекта. Например, я добавил [commitizen](https://github.com/commitizen-tools/commitizen) для автоматического изменения версии проекта в разных файлах, changelog-а и созданием тега в git. Этот процесс рутинный и его надо автоматизировать. Чтобы тулза работала правильно, пришлось начать использовать [conventional commits](https://www.conventionalcommits.org/en/v1.0.0/). Хорошая практика, но нужно проверять каждый коммит, чтобы он соответствовал правилам. Себя я еще могу контролировать, но PR-ы от других людей могут нарушать условия. Поэтому я добавил джобу в github actions. Плюсом джоба в гитхабе может по триггеру автоматечески создавать коммит с помощью commitizen и, таким образом, можно быстро проводить релизы. Триггером может служить мердж в мастер или ручной запуск джобы. Работая над разными проектами, понимаешь какие вещи нужно автоматизировать и добавляешь их в шаблон.

Проблема с Github Actions, которая меня немного напрягает, что гитхаб не триггерит какую-либо джобу после изменений, созданных другой джобой. Например, если commitizen создает релизный тег через джобу, то другая джоба не запустится, которая должна триггериться на новые теги. Разработчки гитхаба специально сделали такое поведение, чтобы не было какого-то автоматического конвейра, который может сломаться, если не провалидировать автоматизацию. Забаный факт, но такое поведение есть только, если вы используете токен, выписанный гитхаб для пуша новых коммитов. Если создатите токен своего аккаунта и будете использовать его вместо дефолтного, то джобы будут триггериться друг другом.

### Cоздание changelog-а

### Сложная конфигурация проекта
